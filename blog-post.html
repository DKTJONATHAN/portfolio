<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <title>Jonathan Mwaniki | Blog Post</title>
    <meta name="description" content="Blog post by Jonathan Mwaniki, Kenya's leading web developer and graphic designer">
    <meta name="keywords" content="Jonathan Mwaniki, web developer Kenya, graphic designer Nairobi, blog">
    <meta name="author" content="Jonathan Mwaniki">
    <meta name="robots" content="index, follow">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16 32x32">
    <link rel="icon" href="/images/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.jonathanmwaniki.co.ke/content/articles/">
    <meta property="og:title" content="Jonathan Mwaniki | Blog Post">
    <meta property="og:description" content="Insights and tutorials by Jonathan Mwaniki">
    <meta property="og:image" content="https://www.jonathanmwaniki.co.ke/images/Jonathan-Mwaniki-logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Jonathan Mwaniki Portfolio">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@maestropuns">
    <meta name="twitter:title" content="Jonathan Mwaniki | Blog Post">
    <meta name="twitter:description" content="Insights and tutorials by Jonathan Mwaniki">
    <meta name="twitter:image" content="https://www.jonathanmwaniki.co.ke/images/Jonathan-Mwaniki-logo.png">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://www.jonathanmwaniki.co.ke/content/articles/">
    
    <!-- Preload Resources -->
    <link rel="stylesheet" href="/styles.css">
    <link rel="preload" href="/styles.css" as="style">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" href="/images/Jonathan-Mwaniki-logo.png" as="image" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" as="style" crossorigin>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">

    <!-- Inline Critical CSS -->
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
            --text-color: #1f2937;
            --light-bg: #f9fafb;
            --white: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: var(--text-color);
            background-color: var(--light-bg);
            line-height: 1.5;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px;
        }

        .blog-post-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .blog-post-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .blog-post-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .blog-post-meta time::after {
            content: '';
            display: inline-block;
            width: 4px;
            height: 4px;
            background: #6b7280;
            border-radius: 50%;
            margin: 0 10px;
        }

        .blog-post-category {
            color: var(--primary-color);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .blog-post-image {
            margin-bottom: 40px;
            border-radius: 8px;
            overflow: hidden;
        }

        .blog-post-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .blog-post-content {
            font-size: 1.125rem;
            color: #4b5563;
            line-height: 1.8;
            margin-bottom: 40px;
        }

        .blog-post-content p {
            margin-bottom: 1.5rem;
        }

        .blog-post-content h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
        }

        .blog-post-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .blog-post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 40px;
        }

        .tag {
            background: #e5e7eb;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            text-decoration: none;
            color: var(--text-color);
        }

        .tag:hover {
            background: var(--primary-color);
            color: white;
        }

        .blog-post-actions {
            text-align: center;
        }

        .btn-primary {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 0.375rem;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .loading-post, .error-post {
            text-align: center;
            padding: 60px 0;
            font-size: 1.2rem;
        }

        .loading-post i {
            margin-right: 10px;
            color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        .error-post {
            color: #d9534f;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 60px 20px;
            }
            .blog-post-title {
                font-size: 2rem;
            }
            .blog-post-content {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .blog-post-title {
                font-size: 1.8rem;
            }
            .blog-post-meta {
                flex-direction: column;
                gap: 8px;
            }
            .blog-post-meta time::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <article id="blog-post" itemscope itemtype="https://schema.org/BlogPosting">
            <div class="loading-post">
                <i class="fas fa-spinner"></i> Loading blog post...
            </div>
        </article>
    </div>

    <script>
        // Utility to unescape HTML
        function unescapeHTML(str) {
            const textarea = document.createElement('textarea');
            textarea.innerHTML = str;
            return textarea.value;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const postContainer = document.getElementById('blog-post');
            const slug = new URLSearchParams(window.location.search).get('slug');

            if (!slug) {
                postContainer.innerHTML = `
                    <div class="error-post">
                        No post specified. <a href="/blogs.html" style="color: var(--primary-color); text-decoration: underline;">Return to Blog</a>
                    </div>
                `;
                return;
            }

            postContainer.innerHTML = `
                <div class="loading-post">
                    <i class="fas fa-spinner"></i> Loading blog post...
                </div>
            `;

            try {
                const response = await fetch(`/.netlify/functions/get-post?file=${encodeURIComponent(slug)}&t=${Date.now()}`);
                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const { data: post } = await response.json();
                if (!post) {
                    throw new Error('Post not found');
                }

                // Unescape content to ensure proper HTML
                const content = unescapeHTML(post.content || 'No content available.');

                // Limit tags to first three
                const tags = post.tags ? post.tags.split(',').map(tag => tag.trim()).filter(tag => tag).slice(0, 3) : [];

                postContainer.innerHTML = `
                    <meta itemprop="mainEntityOfPage" content="/content/articles/${post.slug}.html">
                    <header class="blog-post-header">
                        <h1 class="blog-post-title" itemprop="headline">${post.title || 'Untitled'}</h1>
                        <div class="blog-post-meta">
                            <time datetime="${post.date}" itemprop="datePublished">${new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
                            <span class="blog-post-category" itemprop="articleSection">${post.category || 'Uncategorized'}</span>
                        </div>
                    </header>
                    ${post.image ? `
                    <div class="blog-post-image">
                        <img src="${post.image}" alt="${post.title || 'Blog Post'}" itemprop="image" loading="lazy" width="1200" height="675">
                    </div>
                    ` : ''}
                    <div class="blog-post-content" itemprop="articleBody">
                        ${content}
                    </div>
                    ${tags.length > 0 ? `
                    <div class="blog-post-tags">
                        ${tags.map(tag => `<a href="/blogs.html?tag=${encodeURIComponent(tag)}" class="tag">${tag}</a>`).join('')}
                    </div>
                    ` : ''}
                    <div class="blog-post-actions">
                        <a href="/blogs.html" class="btn-primary" aria-label="Back to all posts">Back to All Posts</a>
                    </div>
                    <meta itemprop="author" content="Jonathan Mwaniki">
                    <meta itemprop="dateModified" content="${post.date}">
                    <meta itemprop="publisher" content="Jonathan Mwaniki">
                `;

                // Update meta tags dynamically
                document.title = `${post.title || 'Blog Post'} | Jonathan Mwaniki`;
                document.querySelector('meta[name="description"]').setAttribute('content', post.description || 'Blog post by Jonathan Mwaniki');
                document.querySelector('meta[property="og:title"]').setAttribute('content', `${post.title || 'Blog Post'} | Jonathan Mwaniki`);
                document.querySelector('meta[property="og:description"]').setAttribute('content', post.description || 'Insights and tutorials by Jonathan Mwaniki');
                document.querySelector('meta[property="og:url"]').setAttribute('content', `https://www.jonathanmwaniki.co.ke/content/articles/${post.slug}.html`);
                document.querySelector('meta[name="twitter:title"]').setAttribute('content', `${post.title || 'Blog Post'} | Jonathan Mwaniki`);
                document.querySelector('meta[name="twitter:description"]').setAttribute('content', post.description || 'Insights and tutorials by Jonathan Mwaniki`);
                if (post.image) {
                    document.querySelector('meta[property="og:image"]').setAttribute('content', post.image);
                    document.querySelector('meta[name="twitter:image"]').setAttribute('content', post.image);
                }

            } catch (error) {
                console.error('Error loading post:', error);
                postContainer.innerHTML = `
                    <div class="error-post">
                        Failed to load post. <a href="/blogs.html" style="color: var(--primary-color); text-decoration: underline;">Return to Blog</a>
                        <p><small>${error.message}</small></p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>